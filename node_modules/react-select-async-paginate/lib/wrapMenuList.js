"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CHECK_TIMEOUT = void 0;
exports.wrapMenuList = wrapMenuList;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _react = require("react");

var _composeReactRefs = _interopRequireDefault(require("@seznam/compose-react-refs"));

var _jsxRuntime = require("react/jsx-runtime");

var CHECK_TIMEOUT = 300;
exports.CHECK_TIMEOUT = CHECK_TIMEOUT;

function wrapMenuList( // eslint-disable-next-line @typescript-eslint/naming-convention
MenuList) {
  function WrappedMenuList(props) {
    var selectProps = props.selectProps,
        innerRef = props.innerRef;
    var _ref = selectProps,
        handleScrolledToBottom = _ref.handleScrolledToBottom,
        shouldLoadMore = _ref.shouldLoadMore;
    var checkTimeoutRef = (0, _react.useRef)();
    var menuListRef = (0, _react.useRef)(null);
    var shouldHandle = (0, _react.useCallback)(function () {
      var el = menuListRef.current; // menu is not rendered

      if (!el) {
        return false;
      }

      var scrollTop = el.scrollTop,
          scrollHeight = el.scrollHeight,
          clientHeight = el.clientHeight;
      return shouldLoadMore(scrollHeight, clientHeight, scrollTop);
    }, [shouldLoadMore]);
    var checkAndHandle = (0, _react.useCallback)(function () {
      if (shouldHandle()) {
        if (handleScrolledToBottom) {
          handleScrolledToBottom();
        }
      }
    }, [shouldHandle, handleScrolledToBottom]);
    var setCheckAndHandleTimeout = (0, _react.useCallback)(function () {
      checkAndHandle();
      checkTimeoutRef.current = setTimeout(setCheckAndHandleTimeout, CHECK_TIMEOUT);
    }, [checkAndHandle]);
    (0, _react.useEffect)(function () {
      setCheckAndHandleTimeout();
      return function () {
        if (checkTimeoutRef.current) {
          clearTimeout(checkTimeoutRef.current);
        }
      };
    }, []);
    return /*#__PURE__*/(0, _jsxRuntime.jsx)(MenuList, (0, _objectSpread2["default"])((0, _objectSpread2["default"])({}, props), {}, {
      innerRef: (0, _composeReactRefs["default"])(innerRef, menuListRef)
    }));
  }

  return WrappedMenuList;
}